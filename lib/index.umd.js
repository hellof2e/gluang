!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@babel/runtime/helpers/classPrivateFieldGet"),require("@babel/runtime/helpers/classPrivateFieldSet"),require("@babel/runtime/helpers/defineProperty"),require("@babel/runtime/helpers/slicedToArray"),require("@babel/runtime/helpers/classCallCheck"),require("@babel/runtime/helpers/createClass"),require("@babel/runtime/helpers/get"),require("@babel/runtime/helpers/inherits"),require("@babel/runtime/helpers/possibleConstructorReturn"),require("@babel/runtime/helpers/getPrototypeOf")):"function"==typeof define&&define.amd?define(["exports","@babel/runtime/helpers/classPrivateFieldGet","@babel/runtime/helpers/classPrivateFieldSet","@babel/runtime/helpers/defineProperty","@babel/runtime/helpers/slicedToArray","@babel/runtime/helpers/classCallCheck","@babel/runtime/helpers/createClass","@babel/runtime/helpers/get","@babel/runtime/helpers/inherits","@babel/runtime/helpers/possibleConstructorReturn","@babel/runtime/helpers/getPrototypeOf"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Quarkc={},e._classPrivateFieldGet,e._classPrivateFieldSet,e._defineProperty,e._slicedToArray,e._classCallCheck,e._createClass,e._get,e._inherits,e._possibleConstructorReturn,e._getPrototypeOf)}(this,(function(e,t,r,n,i,a,s,o,u,l,f){"use strict";function c(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var h=c(t),d=c(r),v=c(n),p=c(i),b=c(a),y=c(s),m=c(o),_=c(u),g=c(l),k=c(f);function O(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}function S(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return C(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return C(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=k.default(e);if(t){var i=k.default(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return g.default(this,r)}}var P=function(){function e(){b.default(this,e),v.default(this,"_observers",void 0),this._observers=[],this._initStateVars()}return y.default(e,[{key:"addObserver",value:function(e,t){this._observers.push({observer:e,keys:t})}},{key:"removeObserver",value:function(e){this._observers=this._observers.filter((function(t){return t.observer!==e}))}},{key:"_initStateVars",value:function(){if(this.constructor.stateVarOptions)for(var e=0,t=Object.entries(this.constructor.stateVarOptions);e<t.length;e++){var r=p.default(t[e],2),n=r[0],i=r[1];this._initStateVar(n,i)}if(this.constructor.stateVars)for(var a=0,s=Object.entries(this.constructor.stateVars);a<s.length;a++){var o=p.default(s[a],2),u=o[0],l=o[1];this._initStateVar(u,{}),this[u]=l}}},{key:"_initStateVar",value:function(e,t){var r=this;if(!this.hasOwnProperty(e)){var n=new((t=this._parseOptions(t)).handler)({options:t,recordRead:function(){return r._recordRead(e)},notifyChange:function(){return r._notifyChange(e)}});Object.defineProperty(this,e,{get:function(){return n.get()},set:function(e){n.shouldSetValue(e)&&n.set(e)},configurable:!0,enumerable:!0})}}},{key:"_parseOptions",value:function(e){return e.handler?e.propertyMethod&&"method"===e.propertyMethod.kind&&Object.assign(e,e.propertyMethod.descriptor.value.call(this)):e.handler=V,e}},{key:"_recordRead",value:function(e){j.recordRead(this,e)}},{key:"_notifyChange",value:function(e){var t,r=S(this._observers);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.keys&&!n.keys.includes(e)||n.observer(e)}}catch(e){r.e(e)}finally{r.f()}}}]),e}(),V=function(){function e(t){b.default(this,e),v.default(this,"options",void 0),v.default(this,"recordRead",void 0),v.default(this,"notifyChange",void 0),v.default(this,"value",void 0),this.options=t.options,this.recordRead=t.recordRead,this.notifyChange=t.notifyChange,this.value=void 0}return y.default(e,[{key:"get",value:function(){return this.recordRead(),this.value}},{key:"set",value:function(e){this.value=e,this.notifyChange()}},{key:"shouldSetValue",value:function(e){return this.value!==e}}]),e}();var w=new WeakMap,j=new(function(){function e(){b.default(this,e),O(this,w,{writable:!0,value:void 0}),d.default(this,w,null)}return y.default(e,[{key:"start",value:function(){d.default(this,w,new Map)}},{key:"recordRead",value:function(e,t){if(h.default(this,w)){var r=h.default(this,w).get(e)||[];r.includes(t)||r.push(t),h.default(this,w).set(e,r)}}},{key:"finish",value:function(){var e=h.default(this,w);return d.default(this,w,null),e}}]),e}());e.StateVar=V,e.connectStore=function(e){return function(e){_.default(r,e);var t=R(r);function r(){var e;return b.default(this,r),(e=t.call(this))._observers=[],e.update(),e}return y.default(r,[{key:"update",value:function(){j.start(),m.default(k.default(r.prototype),"update",this).call(this),this._initStateObservers()}},{key:"_initStateObservers",value:function(){this._clearStateObservers(),this._addStateObservers(j.finish())}},{key:"_addStateObservers",value:function(e){var t,r=this,n=S(e);try{for(n.s();!(t=n.n()).done;){var i=p.default(t.value,2),a=i[0],s=i[1],o=function(){return r.requestUpdate()};this._observers.push([a,o]),a.addObserver(o,s)}}catch(e){n.e(e)}finally{n.f()}}},{key:"_clearStateObservers",value:function(){var e,t=S(this._observers);try{for(t.s();!(e=t.n()).done;){var r=p.default(e.value,2),n=r[0],i=r[1];n.removeObserver(i)}}catch(e){t.e(e)}finally{t.f()}this._observers=[]}}]),r}(e)},e.createGluang=P,e.stateRecorder=j,e.stateVar=function(e){return function(t){return{kind:"field",key:Symbol(),placement:"own",descriptor:{},initializer:function(){"function"==typeof t.initializer&&(this[t.key]=t.initializer.call(this))},finisher:function(r){"method"===t.kind&&(e.propertyMethod=t),r.stateVarOptions||(r.stateVarOptions={}),r.stateVarOptions[t.key]=e}}}},Object.defineProperty(e,"__esModule",{value:!0})}));
